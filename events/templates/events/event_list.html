{% extends "home/base.html" %}
{% load i18n %}
{% load bootstrap4 %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            {% if user.is_authenticated %}
                <a href="{% url 'events:create' %}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> {% trans "Add Event" %}
                </a>
            {% endif %}
        </div>

        {% if events %}
            <div class="row">
                {% for event in events %}
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">
                                    {% if event.link %}
                                        <a href="{{ event.link }}" target="_blank" rel="noopener">{{ event.title }}</a>
                                        <i class="fas fa-external-link-alt fa-sm"></i>
                                    {% else %}
                                        {{ event.title }}
                                    {% endif %}
                                </h5>
                                <p class="card-text">{{ event.description|linebreaks|truncatewords_html:20 }}</p>
                                
                                {% if event.place %}
                                    <div class="mb-2">
                                        <small class="text-muted">
                                            <i class="fas fa-map-marker-alt"></i> {{ event.place }}
                                        </small>
                                    </div>
                                {% endif %}
                                
                                <div class="mb-2">
                                    <small class="text-muted">
                                        <i class="fas fa-calendar"></i> 
                                        {% if event.frequency != 'once' and event.is_upcoming %}
                                            {% with next_occurrence=event.get_next_occurrence %}
                                                {% if next_occurrence %}
                                                    {% trans "Next" %}: {{ next_occurrence|date:"D, Y-m-d H:i" }}
                                                {% else %}
                                                    {{ event.start_date|date:"D, Y-m-d H:i" }}
                                                {% endif %}
                                            {% endwith %}
                                        {% else %}
                                            {{ event.start_date|date:"D, Y-m-d H:i" }}
                                        {% endif %}
                                    </small>
                                </div>
                                
                                <div class="mb-2">
                                    <span class="badge badge-{% if event.frequency == 'once' %}secondary{% else %}info{% endif %}">
                                        {{ event.get_frequency_display }}
                                    </span>
                                    {% if event.is_upcoming %}
                                        <span class="badge badge-success">{% trans "Upcoming" %}</span>
                                    {% endif %}
                                    {% if event.is_public %}
                                        <span class="badge badge-primary" title="{% trans 'Visible to everyone' %}">
                                            <i class="fas fa-globe"></i> {% trans "Public" %}
                                        </span>
                                    {% else %}
                                        <span class="badge badge-warning" title="{% trans 'Visible only to logged-in users' %}">
                                            <i class="fas fa-lock"></i> {% trans "Private" %}
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="card-footer">
                                <a href="{% url 'events:detail' event.pk %}" class="btn btn-sm btn-outline-warning">
                                    {% trans "View Details" %}
                                </a>
                                {% if user.is_authenticated %}
                                    <a href="{% url 'events:edit' event.pk %}" class="btn btn-sm btn-outline-info">
                                        {% trans "Edit" %}
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            {% if is_paginated %}
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1">&laquo; {% trans "First" %}</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">{% trans "Previous" %}</a>
                            </li>
                        {% endif %}

                        <li class="page-item active">
                            <span class="page-link">
                                {% trans "Page" %} {{ page_obj.number }} {% trans "of" %} {{ page_obj.paginator.num_pages }}
                            </span>
                        </li>

                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}">{% trans "Next" %}</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">{% trans "Last" %} &raquo;</a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            {% endif %}
        {% else %}
            <div class="alert alert-info text-center">
                <h4>{% trans "No events yet" %}</h4>
                <p>{% trans "There are no events to display." %}</p>
                {% if user.is_authenticated %}
                    <a href="{% url 'events:create' %}" class="btn btn-primary">
                        {% trans "Create the first event" %}
                    </a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
