{% extends 'glosowania/menu.html' %}

{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}

{% block glosowania %}

	{% if prev %} <a href="{% url 'glosowania:details' pk=prev.id %}"> << </a> {% else %} << {% endif %} |
	{% if next %} <a href="{% url 'glosowania:details' pk=next.id %}"> >> </a> {% else %} >> {% endif %}

	{% if chat_room %}
		<div class="alert alert-info mb-3">
			<i class="fas fa-comments"></i> 
			<a href="{% url 'chat:chat' %}#room_id={{ chat_room.id }}" class="alert-link">
				{% trans 'Discuss this proposal in the chat room' %} "{{ chat_room.title }}"
			</a>
		</div>
	{% endif %}

	<div>
		<h5><u><b>{% trans 'Bill number' %}</b></u> {{ id.id }}</h5>
		<h5><u><b>{% trans 'Bill title' %}</b></u> {{ id.title }}</h5>
		<h5><u><b>{% trans 'Bill state' %}</b></u> {{ state }}</h5>
		<h5><u><b>{% trans 'Bill text' %}</b></u> {{ id.tresc|linebreaks }}</h5>
		<h5><u><b>{% trans 'Penalty for non-compliance' %}</b></u> {{ id.kara|linebreaks }}</h5>
		<h5><u><b>{% trans 'Reason' %}</b></u> {{ id.uzasadnienie|linebreaks }}</h5>
    <h5><u><b>{% trans 'This law supersedes the following bills' %}</b></u> {{ id.znosi|default_if_none:"--" }}</h5>

{% comment %} ARGUMENTS SECTION - Responsive two-column layout {% endcomment %}
	<hr>
	<div class="row">
		{% comment %} Positive Arguments Column - First on mobile, Left on desktop {% endcomment %}
		<div class="col-12 col-lg-6 mb-3">
			<h5><u><b>{% trans 'Positive Arguments' %}</b></u></h5>
			{% if positive_arguments %}
				{% for arg in positive_arguments %}
					<div class="card mb-2">
						<div class="card-body">
							<div class="argument-content">
								{{ arg.content|urlize|linebreaks }}
							</div>
							<div class="argument-meta mt-2">
								<small class="text-muted">
									<strong>{% trans 'By' %}:</strong> {{ arg.author.username|default:"Anonymous" }}
									| <strong>{% trans 'Added' %}:</strong> {{ arg.created_at|date:"Y-m-d H:i" }}
									{% if arg.created_at != arg.modified_at %}
										| <strong>{% trans 'Modified' %}:</strong> {{ arg.modified_at|date:"Y-m-d H:i" }}
									{% endif %}
								</small>
								{% if arg.author == current_user and id.status not in "4,5"|make_list %}
									<div class="mt-1">
										<a href="{% url 'glosowania:edit_argument' arg.id %}" class="btn btn-sm btn-outline-secondary">{% trans 'Edit' %}</a>
										<a href="{% url 'glosowania:delete_argument' arg.id %}" class="btn btn-sm btn-outline-danger">{% trans 'Delete' %}</a>
									</div>
								{% endif %}
							</div>
						</div>
					</div>
				{% endfor %}
			{% else %}
				<p class="text-muted">{% trans 'No positive arguments yet.' %}</p>
			{% endif %}
		</div>

		{% comment %} Negative Arguments Column - Second on mobile, Right on desktop {% endcomment %}
		<div class="col-12 col-lg-6 mb-3">
			<h5><u><b>{% trans 'Negative Arguments' %}</b></u></h5>
			{% if negative_arguments %}
				{% for arg in negative_arguments %}
					<div class="card mb-2">
						<div class="card-body">
							<div class="argument-content">
								{{ arg.content|urlize|linebreaks }}
							</div>
							<div class="argument-meta mt-2">
								<small class="text-muted">
									<strong>{% trans 'By' %}:</strong> {{ arg.author.username|default:"Anonymous" }}
									| <strong>{% trans 'Added' %}:</strong> {{ arg.created_at|date:"Y-m-d H:i" }}
									{% if arg.created_at != arg.modified_at %}
										| <strong>{% trans 'Modified' %}:</strong> {{ arg.modified_at|date:"Y-m-d H:i" }}
									{% endif %}
								</small>
								{% if arg.author == current_user and id.status not in "4,5"|make_list %}
									<div class="mt-1">
										<a href="{% url 'glosowania:edit_argument' arg.id %}" class="btn btn-sm btn-outline-secondary">{% trans 'Edit' %}</a>
										<a href="{% url 'glosowania:delete_argument' arg.id %}" class="btn btn-sm btn-outline-danger">{% trans 'Delete' %}</a>
									</div>
								{% endif %}
							</div>
						</div>
					</div>
				{% endfor %}
			{% else %}
				<p class="text-muted">{% trans 'No negative arguments yet.' %}</p>
			{% endif %}
		</div>
	</div>

	{% comment %} ADD ARGUMENT FORM - Only show before voting ends {% endcomment %}
	{% if user.is_authenticated and id.status not in "4,5"|make_list %}
		<div class="card mt-3 mb-3">
			<div class="card-header">
				<h5 class="mb-0">{% trans 'Add Your Argument' %}</h5>
			</div>
			<div class="card-body">
				<form method="POST" action="{% url 'glosowania:add_argument' id.pk %}">
					{% csrf_token %}
					{{ argument_form|crispy }}
					<button type="submit" class="btn btn-primary btn-sm">{% trans 'Add Argument' %}</button>
				</form>
			</div>
		</div>
	{% endif %}

{% comment %} COMMON FIELDS ENDS HERE {% endcomment %}

	{% comment %} PROPOSITION {% endcomment %}
	{% if id.status == 1 %}
	<hr>
		{% if not signed %}
			<form action="#" method="get" style="display: inline-block;">
				<p><u><h5>{% trans 'Do you want a referendum on this law?' %}</h5></u></p>
				<input class="btn btn-primary btn-sm" type="submit" name="sign" value="{% trans "Yes, I sign" %}"/>
			</form>
		{% elif signed %}
			<p><u><h5>{% trans 'You already signed this proposal.' %}</h5></u></p>
			<form action="#" method="get" style="display: inline-block;">
				<input class="btn btn-danger btn-sm" type="submit" name="withdraw" value="{% trans "Withdraw your sign" %}"/>
			</form>
		{% endif %}

		{% if id.author == None or id.author == current_user %}
			<a class="btn btn-warning btn-sm" href="{% url 'glosowania:edit' id.pk %}">{% trans 'Edit' %}</a>
		{% endif %}
	{% endif %}



	{% comment %} REFERENDUM {% endcomment %}
	{% if id.status == 3 %}
	<hr>
		{% if not voted %}
			<form action="#" method="get">
				<p><u><h5>{% trans 'Do you want to implement this law?' %}</h5></u></p>
				<input class="btn btn-primary btn-sm" type="submit" name="tak" value="{% trans 'Yes' %}"/>
				<input class="btn btn-primary btn-sm" type="submit" name="nie" value="{% trans 'No' %}"/>
			</form>
		{% elif voted %}
			<p><u><h5>{% trans 'You already voted.' %}</h5></u></p>
		{% endif %}
	{% endif %}


	{% comment %} PROTOCOL SO ONLY APPROVED OR REJECTED {% endcomment %}
		{% if id.status == 4 or id.status == 5 %}
		<hr>
		<p>
			<h5><b>{% trans 'Result' %}</b></h5>
			{% trans 'For' %} {{ id.za }} | {% trans 'Against' %} {{ id.przeciw }}
		</p>
		<p>
			<h5><b>{% trans 'Protocol' %}</b></h5>
			{% for i in report %}
				{% if i.vote %}
					{% trans "Yes" %}
				{% else %}
					{% trans "No" %}
				{% endif %}
				{{ i.code }}
				<br>
			{% endfor %}
		</p>
		<p>
			<h5><b>{% trans 'List of people who voted' %}</b></h5>
			{% if voters %}
				{% for voter in voters %}{{ voter.ktory_uzytkownik_juz_zaglosowal.username }}{% if not forloop.last %}, {% endif %}{% endfor %}
			{% else %}
				<em>{% trans 'No votes recorded yet.' %}</em>
			{% endif %}
		</p>
	{% endif %}


{% comment %} FOOTER {% endcomment %}
				<p>
				<small>
				<hr>
				<b>{% trans 'Number of people signed the motion for a referendum' %}</b> {{ id.ile_osob_podpisalo }}
				<br>
				<b>{% trans 'Author' %}</b> {{ id.author|default_if_none:"--" }}
				<br>
				<b>{% trans 'History' %}</b> {{ id.path }}
				<br>
				<b>{% trans 'Date created' %}</b> {{ id.data_powstania }} | 
				<b>{% trans 'Date of collecting signatures' %}</b> {{ id.data_zebrania_podpisow|default_if_none:"--" }} |
				<b>{% trans 'Start referendum' %}</b> {{ id.data_referendum_start|default_if_none:"--" }} |
				{% comment %} {% trans 'End referendum' %}: {{ corrected_data_referendum_stop|default_if_none:"--" }} {% endcomment %}
				<b>{% trans 'End referendum' %}</b> {{ data_referendum_stop|default_if_none:"--" }}
				</small>
				</p>
{% endblock %}
